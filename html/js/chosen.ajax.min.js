(function(a){return a.fn.ajaxChosen=function(f,h,g){var d,c,e,b;if(f==null){f={}}if(g==null){g={}}c={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"};b=this;d=null;e=a.extend({},c,a(b).data(),f);this.chosen(g?g:{});return this.each(function(){return a(this).next(".chosen-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var j,m,l,i,k;i=a(this).val();k=a.trim(a(this).val());m=k.length<e.minTermLength?e.keepTypingMsg:e.lookingForMsg+(" '"+k+"'");b.next(".chosen-container").find(".no-results").text(m);if(k===a(this).data("prevVal")){return false}a(this).data("prevVal",k);if(this.timer){clearTimeout(this.timer)}if(k.length<e.minTermLength){return false}j=a(this);if(e.data==null){e.data={}}e.data[e.jsonTermKey]=k;if(e.dataCallback!=null){e.data=e.dataCallback(e.data)}l=e.success;e.success=function(q){var o,n,p;if(q==null){return}p=[];b.find("option").each(function(){if(!a(this).is(":selected")){return a(this).remove()}else{return p.push(a(this).val()+"-"+a(this).text())}});b.find("optgroup:empty").each(function(){return a(this).remove()});o=h!=null?h(q,j):q;n=0;a.each(o,function(s,r){var u,v,t;n++;if(r.group){u=b.find("optgroup[label='"+r.text+"']");if(!u.size()){u=a("<optgroup />")}u.attr("label",r.text).appendTo(b);return a.each(r.items,function(x,w){var z,y;if(typeof w==="string"){y=x;z=w}else{y=w.value;z=w.text}if(a.inArray(y+"-"+z,p)===-1){return a("<option />").attr("value",y).html(z).appendTo(u)}})}else{if(typeof r==="string"){t=s;v=r}else{t=r.value;v=r.text}if(a.inArray(t+"-"+v,p)===-1){return a("<option />").attr("value",t).html(v).appendTo(b)}}});if(n){b.trigger("chosen:updated")}else{b.data().chosen.no_results_clear();b.data().chosen.no_results(j.val())}if(f.success!=null){f.success(q)}j.css("width","auto");return j.val(i)};return this.timer=setTimeout(function(){if(d){d.abort()}return d=a.ajax(e)},e.afterTypeDelay)})})}})(jQuery);